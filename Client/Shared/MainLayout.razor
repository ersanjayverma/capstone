@using MudBlazor
@inherits LayoutComponentBase
@inject NavigationManager Navigation
@inject AuthenticationStateProvider AuthStateProvider
@inject IJSRuntime JS

<MudThemeProvider @bind-IsDarkMode="@_isDarkMode" Theme="@theme"/>
<MudPopoverProvider/>
<MudDialogProvider/> <!-- 🔥 THIS IS REQUIRED -->
<MudSnackbarProvider/>
<MudLayout>
    <AuthorizeView>
        <Authorized Context="main">
            <!-- 🔷 Drawer -->
            <MudDrawer Open="@State" Elevation="1" Variant="DrawerVariant.Mini" Class="drawer-content">
                <!-- 🔷 ZTACS Logo at Top -->

                <div class="d-flex justify-center mb-4">
                    <a href="#" title="ZTACS by BHB" @onclick="ToggleState" class="ztacs-logo-link">
                        @if (State)
                        {
                            <img src="images/ztacs-logo.svg" alt="ZTACS Logo" style="height:48px;"/>
                        }
                        else
                        {
                            <svg xmlns="http://www.w3.org/2000/svg"
                                 viewBox="0 0 100 100"
                                 height="48"
                                 class="ztacs-logo-svg">
                                <path d="@GetShieldPath()" fill="@GetColor()"/>

                                <!-- Optional label -->
                                <text x="50%" y="60%" text-anchor="middle" fill="#fff"
                                      font-size="18" font-family="Arial" dy=".3em">
                                    @("ZTACS")
                                </text>

                            </svg>
                        }
                    </a>
                </div>

                <style>
                        .ztacs-logo-link {
                            transition: transform 0.2s ease;
                        }

                        .ztacs-logo-link:hover {
                            transform: scale(1.1);
                        }

                        .ztacs-logo-svg {
                            transition: fill 0.3s ease;
                        }
                    </style>
                <!-- Navigation Menu -->
                <MudNavMenu>
                    <MudNavLink Href="/dashboard" Icon="@Icons.Material.Filled.Home">Home</MudNavLink>
                    <MudNavLink Href="/threat-detection" Icon="@Icons.Material.Filled.Dangerous">Threat Detection</MudNavLink>
                    <MudNavLink Href="/profile" Icon="@Icons.Material.Filled.Person">Profile</MudNavLink>
                    <MudNavLink Href="/admin" Icon="@Icons.Material.Filled.AdminPanelSettings">Admin</MudNavLink>
                    <MudNavGroup Title="Reports" Icon="@Icons.Material.Filled.Report">
                        <MudNavLink Href="/admin/threat-logs" Icon="@Icons.Material.Filled.People">Threat-logs</MudNavLink>
                    </MudNavGroup>

                    <MudSpacer/>
                    <AuthorizeView>
                        <Authorized Context="access">
                            <!-- 🔒 Logout at Bottom -->
                            <MudNavLink Href="/logout" Icon="@Icons.Material.Filled.Logout" Class="mt-auto">Logout</MudNavLink>
                        </Authorized>

                    </AuthorizeView>
                </MudNavMenu>
            </MudDrawer>
            <!-- 🟩 Main Content -->
            <MudMainContent Class="p-4">

                @Body
            </MudMainContent>
        </Authorized>
        <NotAuthorized>
            <MudDrawer Open="true" Elevation="1" Variant="DrawerVariant.Mini" Class="drawer-content">
                <!-- 🔷 ZTACS Logo at Top -->
                <div class="d-flex justify-center mb-4">
                    <a href="/dashboard" title="ZTACS Home">
                        <img src="images/ztacs-logo.svg" alt="ZTACS Logo" style="height:48px;"/>
                    </a>
                </div>

                <!-- Navigation Menu -->
                <MudNavMenu>
                    <!-- 🔒 Login at Bottom -->
                    <MudNavLink Href="/login" Icon="@Icons.Material.Filled.Login" Class="mt-auto">Login</MudNavLink>
                </MudNavMenu>
            </MudDrawer>
            <!-- 🟩 Main Content -->
            <MudMainContent Class="p-4">
                @Body

            </MudMainContent>
        </NotAuthorized>
    </AuthorizeView>

</MudLayout>


@code {
    private bool _isDarkMode = true;
    private MudTheme? theme = new();
    public bool State = false;


    private void ToggleState()
    {
        State = !State;
    }

    private string GetShieldPath()
    {
        return "M50 5L90 25v30c0 30-25 40-40 40S10 85 10 55V25L50 5z";
    }

    private string GetColor()
    {
        return "#4caf50";
    }

}